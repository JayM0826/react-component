<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/ListView/index.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/daifee/react-component.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ChildContainer">ChildContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-classNames">classNames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createInstance">createInstance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-config">config</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ActionSheet</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ActionSheet">ActionSheet</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Button</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Button">Button</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Cell</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Cell">Cell</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CellBody">CellBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CellFooter">CellFooter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CellHeader">CellHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Cells">Cells</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CellTips">CellTips</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CellTitle">CellTitle</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Checkbox</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Checkbox">Checkbox</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">DatePicker</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DatePicker/index.js~DatePicker.html">DatePicker</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Dialog</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Dialog">Dialog</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Fade</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Fade">Fade</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Icon</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-IconAttention">IconAttention</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-IconCheck">IconCheck</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-IconLoading">IconLoading</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ListView</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ListView/index.js~ListView.html">ListView</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Mask</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Mask">Mask</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Notification</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Notification">Notification</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Page</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Page">Page</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Popup</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Popup">Popup</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ScrollView</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ScrollView/index.js~ScrollView.html">ScrollView</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Select</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Select/index.js~Select.html">Select</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Switch</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Switch">Switch</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">TabBar</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TabBar">TabBar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TabBarItem">TabBarItem</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Toast</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Toast">Toast</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/ListView/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, {
  Component,
  PropTypes
} from &apos;react&apos;;
import {classNames} from &apos;../utils&apos;;
import &apos;./style&apos;;
import ScrollView from &apos;../ScrollView&apos;;

/**
 * ListView UI
 * @param {object} props see static propTypes
 */
export default class ListView extends Component {

  /**
   * props
   * @type {Object}
   * data: &#x6570;&#x636E;
   * renderRow: &#x6E32;&#x67D3;&#x6BCF;&#x884C;&#x6570;&#x636E;&#xFF0C;&#x53C2;&#x6570;&#x662F; [data[index], index]
   * shouldRefreshIscroller: &#x662F;&#x5426;&#x9700;&#x8981; refresh iscroll&#xFF0C;&#x53C2;&#x6570;&#x662F; [props.data, nextProps.data]
   * renderRefresh: &#x6E32;&#x67D3;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x4EA4;&#x4E92;&#x7EC4;&#x4EF6;&#xFF0C;&#x53C2;&#x6570;&#x662F; [refreshState]
   * offsetRefresh: &#x4E0B;&#x62C9;&#x8DDD;&#x79BB;&#x8D85;&#x8FC7;&#x8BE5;&#x503C;&#xFF0C;&#x5E94;&#x8BE5;&#x6539;&#x53D8; refreshState
   * refreshState: &#x4E0B;&#x62C9;&#x5237;&#x65B0;&#x72B6;&#x6001;
   * onNormalRefresh: &#x544A;&#x77E5;&#x7236;&#x7EC4;&#x4EF6;&#x5E94;&#x8BE5;&#x5C06; refreshState &#x8BBE;&#x7F6E;&#x4E3A; normal
   * onReadyRefresh: &#x544A;&#x77E5;&#x7236;&#x7EC4;&#x4EF6;&#x5E94;&#x8BE5;&#x5C06; refreshState &#x8BBE;&#x7F6E;&#x4E3A; ready
   * onRefresh: &#x544A;&#x77E5;&#x7236;&#x7EC4;&#x4EF6;&#x5E94;&#x8BE5;&#x5C06; refreshState &#x8BBE;&#x7F6E;&#x4E3A; loading
   * renderLoadMore: &#x6E32;&#x67D3;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&#x7684;&#x4EA4;&#x4E92;&#x7EC4;&#x4EF6;
   * offsetLoadMore: ListView &#x5E95;&#x90E8;&#x8DDD;&#x79BB;&#x89C6;&#x53E3;&#x8DDD;&#x79BB;&#x5C0F;&#x4E8E;&#x8BE5;&#x503C;&#xFF0C;&#x5E94;&#x8BE5;&#x6539;&#x53D8; loadMoreState
   * onLoadMore: &#x544A;&#x77E5;&#x7236;&#x7EC4;&#x4EF6;&#x5E94;&#x8BE5;&#x5C06; loadMoreState &#x8BBE;&#x7F6E;&#x4E3A; loading
   */
  static propTypes = {
    data: PropTypes.array.isRequired,
    renderRow: PropTypes.func.isRequired,
    shouldRefreshIscroller: PropTypes.func.isRequired,
    renderRefresh: PropTypes.func,
    offsetRefresh: PropTypes.number,
    refreshState: PropTypes.oneOf([&apos;none&apos;, &apos;normal&apos;, &apos;ready&apos;, &apos;loading&apos;]),
    onNormalRefresh: PropTypes.func,
    onReadyRefresh: PropTypes.func,
    onRefresh: PropTypes.func,
    renderLoadMore: PropTypes.func,
    offsetLoadMore: PropTypes.number,
    loadMoreState: PropTypes.oneOf([&apos;none&apos;, &apos;normal&apos;, &apos;loading&apos;, &apos;end&apos;, &apos;fail&apos;]),
    onLoadMore: PropTypes.func,
    className: PropTypes.string
  };

  static defaultProps = {
    offsetRefresh: 60,
    offsetLoadMore: 6,
    refreshState: &apos;none&apos;,
    loadMoreState: &apos;none&apos;,
    renderRefresh: renderRefresh,
    renderLoadMore: renderLoadMore
  };

  static renderRefresh = renderRefresh;
  static renderLoadMore = renderLoadMore;

  // iscroll &#x5B9E;&#x4F8B;
  iscroller = null;

  scrollToTop() {
    this.iscroller.scrollTo(0, 0, 600);
  }

  // &#x70B9;&#x51FB;&#x6309;&#x94AE;&#x5237;&#x65B0;&#xFF0C;&#x9700;&#x8981;&#x6EDA;&#x52A8;&#x5230;&#x9876;&#x90E8;
  scrollToRefresh() {
    this.iscroller.offsetY = this.props.offsetRefresh;
    this.scrollToTop();
  }

  _refreshIscroller = () =&gt; {
    this.iscroller.refresh();
  };

  _onLoadMore = () =&gt; {
    let {loadMoreState, onLoadMore} = this.props;

    if (loadMoreState === &apos;loading&apos; || loadMoreState === &apos;end&apos;) {
      return;
    }

    onLoadMore();
  };

  render() {
    let {
      data,
      renderRow,
      renderRefresh,
      refreshState,
      renderLoadMore,
      loadMoreState,
      className,
      shouldRefreshIscroller,
      ...others
    } = this.props;
    className = classNames(&apos;list-view&apos;, {_user: className});

    return (
      &lt;ScrollView
        ref=&apos;scrollView&apos;
        className={className}
        height=&apos;100%&apos;
        width=&apos;100%&apos;
        {...others}&gt;
        &lt;div className={classNames(&apos;list-view-refresh&apos;)}&gt;
          {renderRefresh(refreshState)}
        &lt;/div&gt;
        &lt;List
          data={data}
          shouldRefreshIscroller={shouldRefreshIscroller}
          refreshIscroller={this._refreshIscroller}&gt;
          &lt;div className={classNames(&apos;list-view-list&apos;)}&gt;
            {data.map(renderRow)}
          &lt;/div&gt;
        &lt;/List&gt;
        &lt;div
          className={classNames(&apos;list-view-load-more&apos;)}
          onClick={this._onLoadMore}&gt;
          {renderLoadMore(loadMoreState)}
        &lt;/div&gt;
      &lt;/ScrollView&gt;
    );
  }

  componentDidMount() {
    this.iscroller = this.refs.scrollView.iscroller;

    this._bindLoadMore();
    this._bindRefresh();

    // &#x5237;&#x65B0; iscroller&#xFF0C;&#x6BCF;&#x6B21; data &#x53D8;&#x5316;&#x90FD;&#x8981;&#x5728; List &#x7EC4;&#x4EF6;&#x5185;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x5237;&#x65B0;
    this._refreshIscroller();
    // &#x5982;&#x679C; refreshState=loading &#x9700;&#x8981;&#x8BBE;&#x7F6E; iscroller.offsetY
    this._updateOffsetY();
  }

  componentDidUpdate() {
    this._updateOffsetY();
  }

  _updateOffsetY() {
    let {offsetRefresh, refreshState} = this.props;

    this.iscroller.offsetY = refreshState === &apos;loading&apos; ? offsetRefresh : 0;
  }

  _bindLoadMore() {
    let {offsetLoadMore} = this.props;
    let iscroller = this.iscroller;

    iscroller.on(&apos;scroll&apos;, () =&gt; {
      // &#x5224;&#x65AD;&#x8DDD;&#x79BB;
      if (iscroller.maxScrollY - iscroller.y &gt; offsetLoadMore) {
        this._onLoadMore();
      }
    });
  }

  _bindRefresh() {
    let {
      offsetRefresh,
      onReadyRefresh,
      onNormalRefresh,
      onRefresh
    } = this.props;
    let iscroller = this.iscroller;

    iscroller.on(&apos;scroll&apos;, () =&gt; {
      let {refreshState} = this.props;
      let y = iscroller.y;

      if (y &lt; 0 || refreshState === &apos;loading&apos;) {
        return;
      }

      // &#x4E0B;&#x62C9;&#x8DDD;&#x79BB;&#x8D85;&#x8FC7; offsetRefresh &#x6FC0;&#x6D3B;&#x72B6;&#x6001;
      if (iscroller.y &gt; offsetRefresh) {
        refreshState !== &apos;ready&apos; &amp;&amp; onReadyRefresh();
      } else {
        refreshState !== &apos;normal&apos; &amp;&amp; onNormalRefresh();
      }
    });

    iscroller.on(&apos;touchEnd&apos;, () =&gt; {
      let {refreshState} = this.props;

      if (refreshState !== &apos;ready&apos;) {
        return;
      }

      onRefresh();
    });
  }
}


// &#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x8C03;&#x7528; this.props.refreshIscroller();
class List extends Component {
  static propTypes = {
    data: PropTypes.array.isRequired,
    shouldRefreshIscroller: PropTypes.func.isRequired,
    refreshIscroller: PropTypes.func.isRequired,
    children: PropTypes.node.isRequired
  };

  shouldComponentUpdate(nextProps) {
    return this.props.shouldRefreshIscroller(this.props.data, nextProps.data);
  }

  render() {
    let {children} = this.props;

    return children.length === 0 ? null : children;
  }

  componentDidUpdate() {
    let {refreshIscroller} = this.props;
    // &#x4E3A;&#x4E86;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x624D;&#x62BD;&#x8C61;&#x51FA; List &#x7EC4;&#x4EF6;&#x7684;
    refreshIscroller();
  }
}



function renderRefresh(status) {
  switch (status) {
    case &apos;none&apos;:
      return null;
    case &apos;normal&apos;:
      return (&lt;p&gt;&#x4E0B;&#x62C9;&#x5237;&#x65B0;&lt;/p&gt;);
    case &apos;ready&apos;:
      return (&lt;p&gt;&#x677E;&#x624B;&#x5373;&#x53EF;&#x5237;&#x65B0;&lt;/p&gt;);
    case &apos;loading&apos;:
      return (&lt;p&gt;&#x52A0;&#x8F7D;&#x4E2D;...&lt;/p&gt;);
  }

  return null;
}


function renderLoadMore(status) {
  switch (status) {
    case &apos;none&apos;:
      return null;
    case &apos;normal&apos;:
      return (&lt;p&gt;&#x70B9;&#x51FB;&#xFF0C;&#x52A0;&#x8F7D;&#x66F4;&#x591A;&lt;/p&gt;);
    case &apos;loading&apos;:
      return (&lt;p&gt;&#x52A0;&#x8F7D;&#x4E2D;...&lt;/p&gt;);
    case &apos;end&apos;:
      return (&lt;p&gt;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x4E86;&lt;/p&gt;);
    case &apos;fail&apos;:
      return (&lt;p&gt;&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x70B9;&#x51FB;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&lt;/p&gt;);
  }

  return null;
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
